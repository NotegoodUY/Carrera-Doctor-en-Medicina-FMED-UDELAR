<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NoteGood 路 Iniciar sesi贸n</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f172a;--fg:#e2e8f0;--card:#111827;--btn:#22c55e;--btnh:#16a34a}
    *{box-sizing:border-box} body{margin:0;font-family:Poppins,system-ui,Segoe UI,Roboto,sans-serif;background:linear-gradient(160deg,#0f172a,#111827);color:var(--fg);min-height:100vh;display:grid;place-items:center}
    .card{width:min(720px,92vw);background:rgba(17,24,39,.75);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);border-radius:22px;padding:32px;box-shadow:0 20px 60px rgba(0,0,0,.45)}
    h1{margin:0 0 8px;font-size:28px} p{margin:0 0 18px;opacity:.85}
    .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    .btn{cursor:pointer;border:0;border-radius:14px;padding:14px 18px;font-weight:700}
    .btn.primary{background:var(--btn);color:#04210f} .btn.primary:hover{background:var(--btnh)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.18);color:var(--fg)}
    .hint{font-size:.9rem;opacity:.7;margin-top:8px}
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>NoteGood 路 Malla Interactiva</h1>
    <p>Inici谩 sesi贸n para guardar tu avance, notas y calificaciones en la nube.</p>

    <div id="userRow" style="display:none;margin:14px 0 8px;opacity:.9"></div>

    <div class="actions">
      <button id="loginGoogleLanding" class="btn primary"> Entrar con Google</button>
      <a id="goMalla" class="btn ghost" href="malla.html" style="display:none">★ Ir a la malla</a>
      <button id="logoutLanding" class="btn ghost" style="display:none"> Cerrar sesi贸n</button>
    </div>
    <div class="hint">Usamos tu cuenta solo para identificarte y sincronizar tu progreso. Pod茅s cerrar sesi贸n cuando quieras.</div>
  </main>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script>
    //  TU CONFIG REAL
    window.FB_CONFIG = {
      apiKey: "AIzaSyB8QcsmSE6YMxNyyBo9y8j6iIT3pHsebs",
      authDomain: "notegood-uy.firebaseapp.com",
      projectId: "notegood-uy",
      storageBucket: "notegood-uy.appspot.com",
      messagingSenderId: "690615845783",
      appId: "1:690615845783:web:6f6bfacc9f3d77d1dfbad2",
      measurementId: "G-4SL4JL2GH5"
    };
    // Init (solo una vez)
    if (!firebase.apps?.length) firebase.initializeApp(window.FB_CONFIG);
    const auth = firebase.auth();

    const $ = (id)=>document.getElementById(id);
    const loginBtn = $('loginGoogleLanding');
    const goMalla  = $('goMalla');
    const logoutBtn= $('logoutLanding');
    const userRow  = $('userRow');

    // Si ya vino desde una redirecci贸n, respetamos ?redirect=
    function nextUrl(){
      const u = new URL(location.href);
      const r = u.searchParams.get('redirect');
      return r || 'malla.html';
    }

    loginBtn?.addEventListener('click', async ()=>{
      try{
        await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
        location.href = nextUrl();
      }catch(e){ alert('No se pudo iniciar sesi贸n: ' + e.message); }
    });

    logoutBtn?.addEventListener('click', async ()=>{
      await auth.signOut();
      location.href = 'index.html';
    });

    auth.onAuthStateChanged((user)=>{
      if (user){
        userRow.style.display='block';
        userRow.textContent = `Conectada: ${user.displayName || user.email}`;
        loginBtn.style.display='none';
        logoutBtn.style.display='';
        goMalla.style.display='';
      }else{
        userRow.style.display='none';
        loginBtn.style.display='';
        logoutBtn.style.display='none';
        goMalla.style.display='none';
      }
    });
  </script>
</body>
</html>
